<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout/default">
<head>
<meta charset="utf-8" />
<title>采购</title>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" th:href="@{/styles/iview.css}" />
<style type="text/css">
.layout-breadcrumb{
    padding: 0px;margin-bottom:10px;
}
</style>
</head>
<body style="background-color: #eee;">
<div layout:fragment="content" style="width:1280px;min-height: 600px;margin:15px auto;background-color: #ffffff;">
<template id="stock_in" style="">
    <div>
        <Modal v-model="visible" title="Welcome">欢迎使用 iView index</Modal>
        <i-select
            v-model="stock"
            filterable
            remote
            placeholder="请选择物品"
            size="large"
            :remote-method="remoteMethod"
            :loading="loading"
            style="width:400px"
        >
            <i-option v-for="item in stockList" :value="item.abbr" :key="item.abbr">{{item.stockName}}</i-option>
        </i-select>
        <i-button type="primary" @click="submitForm">提交</i-button>
    </div>
</template>
<div id="layout-breadcrumb" class="layout-breadcrumb">
    <div style="padding:10px;background-color: #fff;">
        <Breadcrumb>
            <Breadcrumb-item href="#">库存</Breadcrumb-item>
            <Breadcrumb-item href="#">单据</Breadcrumb-item>
            <Breadcrumb-item>采购</Breadcrumb-item>
        </Breadcrumb>
    </div>
    <div style="height:15px;background-color: #eee;"></div>
</div>
<div id="app" style="padding: 10px;">
    <router-view></router-view>
</div>
<script th:src="@{/js/vue.min.js}"></script>
<script th:src="@{/js/iview.min.js}"></script>
<script th:src="@{/js/vue-router.js}"></script>
<script th:src="@{/js/vue-resource.min.js}"></script>
<script th:src="@{/js/jquery-3.2.1.min.js}"></script>
<script th:inline="javascript">
    var stock_in = {
        template: '#stock_in',
        data: function() {
            return {
                visible: false,
                loading: false,
                stock:"",
                stockList:[],
                list:[

                ]
            }
        },
        created : function  () {
            this.loadData()
        },
        methods: {
            show: function () {
                var report = {
                    id:'111',
                    remark:'hahahehe'
                }
                this.$http.get('/stock/api/list',{
//                    emulateJSON:true
                }).then(function(response){
                    console.info("response:"+response);
                    console.info("response.data:"+response.data);
                    console.info("response.data:"+response.data.data);
                    console.info("response.name:"+response.name);
                    this.visible = true;
                }, function(response){
                    console.info(response);
                })
                //alert(' test ')
            },
            loadData: function () {
                var item = {
                    abbr: 'beijing',
                    stockName: '测试物品',
                    stockId: '0'
                }
                this.stockList.push(item)
                this.list.push(item)
                this.$http.get('/stock/api/list',{}).then(function(response){
                    this.list = response.data;
                }, function(response){

                }).bind(this);
            },
            handleSubmit: function (name) {
                var that = this;
                this.$refs[name].validate(function(valid){
                    if (valid) {
                        that.$Message.success('提交成功!');
                    } else {
                        that.$Message.error('表单验证失败!');
                    }
                });
            },
            submitForm: function () {
                alert(this.stock)
            },
            remoteMethod: function (query) {
//                alert(query)
//                this.stockList = this.list;
                if (query !== '') {
                    this.loading = true;
                    this.stockList = [];
                    this.loading = false;
                    this.stockList = this.list.filter(function(elem, pos) {
                        return elem.abbr.toLowerCase().indexOf(query.toLowerCase()) == 0||elem.stockName.toLowerCase().indexOf(query.toLowerCase()) > -1;
                    })
                }else{
                    this.stockList = [];
                }
            }
        }
    }

    var routes = [
        {
            path: '/',
            name: 'stock_in',
            component: stock_in
        }

    ]

    var router = new VueRouter({
        routes: routes
    });

    router.beforeEach( function(to, from, next) {
        next()
    })

    var app = new Vue({
        el:'#app',
        router:router
    })

    var breadcrumb = new Vue({
        el:'#layout-breadcrumb'
    })

</script>
</div>
</body>
</html>